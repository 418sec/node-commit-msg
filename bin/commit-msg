#!/usr/bin/env node

// clns/node-commit-msg
// http://git-scm.com/docs/githooks#_commit_msg

var path = require('path');
var CommitMessage = require(path.normalize(path.resolve(__dirname, '..')));

var file = process.argv[2]; // usually '.git/COMMIT_EDITMSG'
var message = CommitMessage.parseFromFile(file);

if (message.hasWarnings) {
    console.log('Commit message warnings:');
    console.log(message.formattedWarnings);
}
if (!message.valid) {
    console.error('Commit message errors:');
    console.error(message.formattedErrors);

    console.error('Commit aborted due to invalid commit message.');
    // https://nodejs.org/api/process.html#process_exit_codes
    process.exit(9); // Invalid Argument
}
