#!/usr/bin/env node

// clns/node-commit-msg
// http://git-scm.com/docs/githooks#_commit_msg

var path = require('path');
var CommitMessage = require('..');

var file = process.argv[2]; // usually '.git/COMMIT_EDITMSG'
CommitMessage.parseFromFile(file, path.dirname(process.argv[0]), function(err, message) {
    if (message.hasErrors() || message.hasWarnings()) {
        console.log(message.formattedMessages);
    }
    if (message.hasErrors()) {
        console.error('Commit failed due to invalid commit message, see',
        'https://github.com/clns/node-commit-msg/blob/master/CONTRIBUTING.md#commit-message');
        console.error('---');
        console.error(message.message);
        // https://nodejs.org/api/process.html#process_exit_codes
        process.exit(1); // Uncaught Fatal Exception
    }
});
